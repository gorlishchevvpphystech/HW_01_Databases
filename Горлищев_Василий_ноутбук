{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "39581de5",
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "086f39ed",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/var/folders/sf/p23y9zqn1j70gvtfhfy_r5780000gn/T/ipykernel_9155/3311783410.py:2: FutureWarning: Inferring datetime64[ns] from data containing strings is deprecated and will be removed in a future version. To retain the old behavior explicitly pass Series(data, dtype=datetime64[ns])\n",
      "  data = pd.read_excel('customer_and_transaction.xlsx', sheet_name=['transaction', 'customer'])\n"
     ]
    }
   ],
   "source": [
    "# Изучим данные, 2 листа\n",
    "data = pd.read_excel('customer_and_transaction.xlsx', sheet_name=['transaction', 'customer'])\n",
    "\n",
    "# Доступ к данным каждого листа\n",
    "transaction = data['transaction']\n",
    "customer = data['customer']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "36512a35",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 20000 entries, 0 to 19999\n",
      "Data columns (total 12 columns):\n",
      " #   Column            Non-Null Count  Dtype         \n",
      "---  ------            --------------  -----         \n",
      " 0   transaction_id    20000 non-null  int64         \n",
      " 1   product_id        20000 non-null  int64         \n",
      " 2   customer_id       20000 non-null  int64         \n",
      " 3   transaction_date  20000 non-null  datetime64[ns]\n",
      " 4   online_order      19640 non-null  object        \n",
      " 5   order_status      20000 non-null  object        \n",
      " 6   brand             19803 non-null  object        \n",
      " 7   product_line      19803 non-null  object        \n",
      " 8   product_class     19803 non-null  object        \n",
      " 9   product_size      19803 non-null  object        \n",
      " 10  list_price        20000 non-null  float64       \n",
      " 11  standard_cost     19803 non-null  float64       \n",
      "dtypes: datetime64[ns](1), float64(2), int64(3), object(6)\n",
      "memory usage: 1.8+ MB\n",
      "None\n",
      "transaction_id        0\n",
      "product_id            0\n",
      "customer_id           0\n",
      "transaction_date      0\n",
      "online_order        360\n",
      "order_status          0\n",
      "brand               197\n",
      "product_line        197\n",
      "product_class       197\n",
      "product_size        197\n",
      "list_price            0\n",
      "standard_cost       197\n",
      "dtype: int64\n"
     ]
    }
   ],
   "source": [
    "# Изучим типы данных transaction\n",
    "print(transaction.info())\n",
    "\n",
    "# Подсчет пропусков в каждом столбце\n",
    "print(transaction.isnull().sum())\n",
    "\n",
    "# int64 будут integer\n",
    "# datetime64 будут timestamp\n",
    "# object будут varchar\n",
    "# float64 будут float\n",
    "# строки где нет null будут non null, остальные nullable"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "17fcd5ef",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 4000 entries, 0 to 3999\n",
      "Data columns (total 15 columns):\n",
      " #   Column                 Non-Null Count  Dtype         \n",
      "---  ------                 --------------  -----         \n",
      " 0   customer_id            4000 non-null   int64         \n",
      " 1   first_name             4000 non-null   object        \n",
      " 2   last_name              3875 non-null   object        \n",
      " 3   gender                 4000 non-null   object        \n",
      " 4   DOB                    3913 non-null   datetime64[ns]\n",
      " 5   job_title              3494 non-null   object        \n",
      " 6   job_industry_category  3344 non-null   object        \n",
      " 7   wealth_segment         4000 non-null   object        \n",
      " 8   deceased_indicator     4000 non-null   object        \n",
      " 9   owns_car               4000 non-null   object        \n",
      " 10  address                4000 non-null   object        \n",
      " 11  postcode               4000 non-null   int64         \n",
      " 12  state                  4000 non-null   object        \n",
      " 13  country                4000 non-null   object        \n",
      " 14  property_valuation     4000 non-null   int64         \n",
      "dtypes: datetime64[ns](1), int64(3), object(11)\n",
      "memory usage: 468.9+ KB\n",
      "None\n",
      "customer_id                0\n",
      "first_name                 0\n",
      "last_name                125\n",
      "gender                     0\n",
      "DOB                       87\n",
      "job_title                506\n",
      "job_industry_category    656\n",
      "wealth_segment             0\n",
      "deceased_indicator         0\n",
      "owns_car                   0\n",
      "address                    0\n",
      "postcode                   0\n",
      "state                      0\n",
      "country                    0\n",
      "property_valuation         0\n",
      "dtype: int64\n"
     ]
    }
   ],
   "source": [
    "# Изучим типы данных customer\n",
    "print(customer.info())\n",
    "\n",
    "# Подсчет пропусков в каждом столбце\n",
    "print(customer.isnull().sum())\n",
    "\n",
    "# int64 будут integer \n",
    "# datetime64 будут timestamp\n",
    "# object будут varchar\n",
    "# float64 будут float\n",
    "# строки где нет null будут non null, остальные nullable"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "0666b19f",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Index(['online_order', 'order_status', 'brand', 'product_line',\n",
      "       'product_class', 'product_size'],\n",
      "      dtype='object')\n",
      "Число перечеслиний: online_order 0        False\n",
      "1        False\n",
      "2        False\n",
      "3        False\n",
      "4        False\n",
      "         ...  \n",
      "19995    False\n",
      "19996    False\n",
      "19997    False\n",
      "19998    False\n",
      "19999    False\n",
      "Name: online_order, Length: 20000, dtype: bool\n",
      "Число перечеслиний: order_status 0        False\n",
      "1        False\n",
      "2        False\n",
      "3        False\n",
      "4        False\n",
      "         ...  \n",
      "19995    False\n",
      "19996    False\n",
      "19997    False\n",
      "19998    False\n",
      "19999    False\n",
      "Name: order_status, Length: 20000, dtype: bool\n",
      "Число перечеслиний: brand 0        False\n",
      "1        False\n",
      "2        False\n",
      "3        False\n",
      "4        False\n",
      "         ...  \n",
      "19995    False\n",
      "19996    False\n",
      "19997    False\n",
      "19998    False\n",
      "19999    False\n",
      "Name: brand, Length: 20000, dtype: bool\n",
      "Число перечеслиний: product_line 0        False\n",
      "1        False\n",
      "2        False\n",
      "3        False\n",
      "4        False\n",
      "         ...  \n",
      "19995    False\n",
      "19996    False\n",
      "19997    False\n",
      "19998    False\n",
      "19999    False\n",
      "Name: product_line, Length: 20000, dtype: bool\n",
      "Число перечеслиний: product_class 0        False\n",
      "1        False\n",
      "2        False\n",
      "3        False\n",
      "4        False\n",
      "         ...  \n",
      "19995    False\n",
      "19996    False\n",
      "19997    False\n",
      "19998    False\n",
      "19999    False\n",
      "Name: product_class, Length: 20000, dtype: bool\n",
      "Число перечеслиний: product_size 0        False\n",
      "1        False\n",
      "2        False\n",
      "3        False\n",
      "4        False\n",
      "         ...  \n",
      "19995    False\n",
      "19996    False\n",
      "19997    False\n",
      "19998    False\n",
      "19999    False\n",
      "Name: product_size, Length: 20000, dtype: bool\n"
     ]
    }
   ],
   "source": [
    "# Проверим на 1Ф - все-ли типы object (varchar) являются скалярами \n",
    "object_columns = transaction.select_dtypes(include=['object']).columns\n",
    "print(object_columns)\n",
    "\n",
    "for column in object_columns:\n",
    "    has_commas = transaction[column].astype(str).str.contains(',', na=False)\n",
    "    print(f\"Число перечеслиний: {column} {has_commas}\")\n",
    "    \n",
    "# Таблица transaction ОК\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "6371a806",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Index(['first_name', 'last_name', 'gender', 'job_title',\n",
      "       'job_industry_category', 'wealth_segment', 'deceased_indicator',\n",
      "       'owns_car', 'address', 'state', 'country'],\n",
      "      dtype='object')\n",
      "Число перечеслиний: first_name 0       False\n",
      "1       False\n",
      "2       False\n",
      "3       False\n",
      "4       False\n",
      "        ...  \n",
      "3995    False\n",
      "3996    False\n",
      "3997    False\n",
      "3998    False\n",
      "3999    False\n",
      "Name: first_name, Length: 4000, dtype: bool\n",
      "Число перечеслиний: last_name 0       False\n",
      "1       False\n",
      "2       False\n",
      "3       False\n",
      "4       False\n",
      "        ...  \n",
      "3995    False\n",
      "3996    False\n",
      "3997    False\n",
      "3998    False\n",
      "3999    False\n",
      "Name: last_name, Length: 4000, dtype: bool\n",
      "Число перечеслиний: gender 0       False\n",
      "1       False\n",
      "2       False\n",
      "3       False\n",
      "4       False\n",
      "        ...  \n",
      "3995    False\n",
      "3996    False\n",
      "3997    False\n",
      "3998    False\n",
      "3999    False\n",
      "Name: gender, Length: 4000, dtype: bool\n",
      "Число перечеслиний: job_title 0       False\n",
      "1       False\n",
      "2       False\n",
      "3       False\n",
      "4       False\n",
      "        ...  \n",
      "3995    False\n",
      "3996    False\n",
      "3997    False\n",
      "3998    False\n",
      "3999    False\n",
      "Name: job_title, Length: 4000, dtype: bool\n",
      "Число перечеслиний: job_industry_category 0       False\n",
      "1       False\n",
      "2       False\n",
      "3       False\n",
      "4       False\n",
      "        ...  \n",
      "3995    False\n",
      "3996    False\n",
      "3997    False\n",
      "3998    False\n",
      "3999    False\n",
      "Name: job_industry_category, Length: 4000, dtype: bool\n",
      "Число перечеслиний: wealth_segment 0       False\n",
      "1       False\n",
      "2       False\n",
      "3       False\n",
      "4       False\n",
      "        ...  \n",
      "3995    False\n",
      "3996    False\n",
      "3997    False\n",
      "3998    False\n",
      "3999    False\n",
      "Name: wealth_segment, Length: 4000, dtype: bool\n",
      "Число перечеслиний: deceased_indicator 0       False\n",
      "1       False\n",
      "2       False\n",
      "3       False\n",
      "4       False\n",
      "        ...  \n",
      "3995    False\n",
      "3996    False\n",
      "3997    False\n",
      "3998    False\n",
      "3999    False\n",
      "Name: deceased_indicator, Length: 4000, dtype: bool\n",
      "Число перечеслиний: owns_car 0       False\n",
      "1       False\n",
      "2       False\n",
      "3       False\n",
      "4       False\n",
      "        ...  \n",
      "3995    False\n",
      "3996    False\n",
      "3997    False\n",
      "3998    False\n",
      "3999    False\n",
      "Name: owns_car, Length: 4000, dtype: bool\n",
      "Число перечеслиний: address 0       False\n",
      "1       False\n",
      "2       False\n",
      "3       False\n",
      "4       False\n",
      "        ...  \n",
      "3995    False\n",
      "3996    False\n",
      "3997    False\n",
      "3998    False\n",
      "3999    False\n",
      "Name: address, Length: 4000, dtype: bool\n",
      "Число перечеслиний: state 0       False\n",
      "1       False\n",
      "2       False\n",
      "3       False\n",
      "4       False\n",
      "        ...  \n",
      "3995    False\n",
      "3996    False\n",
      "3997    False\n",
      "3998    False\n",
      "3999    False\n",
      "Name: state, Length: 4000, dtype: bool\n",
      "Число перечеслиний: country 0       False\n",
      "1       False\n",
      "2       False\n",
      "3       False\n",
      "4       False\n",
      "        ...  \n",
      "3995    False\n",
      "3996    False\n",
      "3997    False\n",
      "3998    False\n",
      "3999    False\n",
      "Name: country, Length: 4000, dtype: bool\n"
     ]
    }
   ],
   "source": [
    "# Проверим на 1Ф - все-ли типы object (varchar) являются скалярами \n",
    "object_columns = customer.select_dtypes(include=['object']).columns\n",
    "print(object_columns)\n",
    "\n",
    "for column in object_columns:\n",
    "    has_commas = customer[column].astype(str).str.contains(',', na=False)\n",
    "    print(f\"Число перечеслиний: {column} {has_commas}\")\n",
    "    \n",
    "# Таблица customer ОК\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "736e62e6",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>transaction_id</th>\n",
       "      <th>product_id</th>\n",
       "      <th>customer_id</th>\n",
       "      <th>transaction_date</th>\n",
       "      <th>online_order</th>\n",
       "      <th>order_status</th>\n",
       "      <th>brand</th>\n",
       "      <th>product_line</th>\n",
       "      <th>product_class</th>\n",
       "      <th>product_size</th>\n",
       "      <th>list_price</th>\n",
       "      <th>standard_cost</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>2</td>\n",
       "      <td>2950</td>\n",
       "      <td>2017-02-25</td>\n",
       "      <td>False</td>\n",
       "      <td>Approved</td>\n",
       "      <td>Solex</td>\n",
       "      <td>Standard</td>\n",
       "      <td>medium</td>\n",
       "      <td>medium</td>\n",
       "      <td>71.49</td>\n",
       "      <td>53.62</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>3</td>\n",
       "      <td>3120</td>\n",
       "      <td>2017-05-21</td>\n",
       "      <td>True</td>\n",
       "      <td>Approved</td>\n",
       "      <td>Trek Bicycles</td>\n",
       "      <td>Standard</td>\n",
       "      <td>medium</td>\n",
       "      <td>large</td>\n",
       "      <td>2091.47</td>\n",
       "      <td>388.92</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>37</td>\n",
       "      <td>402</td>\n",
       "      <td>2017-10-16</td>\n",
       "      <td>False</td>\n",
       "      <td>Approved</td>\n",
       "      <td>OHM Cycles</td>\n",
       "      <td>Standard</td>\n",
       "      <td>low</td>\n",
       "      <td>medium</td>\n",
       "      <td>1793.43</td>\n",
       "      <td>248.82</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>88</td>\n",
       "      <td>3135</td>\n",
       "      <td>2017-08-31</td>\n",
       "      <td>False</td>\n",
       "      <td>Approved</td>\n",
       "      <td>Norco Bicycles</td>\n",
       "      <td>Standard</td>\n",
       "      <td>medium</td>\n",
       "      <td>medium</td>\n",
       "      <td>1198.46</td>\n",
       "      <td>381.10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>78</td>\n",
       "      <td>787</td>\n",
       "      <td>2017-10-01</td>\n",
       "      <td>True</td>\n",
       "      <td>Approved</td>\n",
       "      <td>Giant Bicycles</td>\n",
       "      <td>Standard</td>\n",
       "      <td>medium</td>\n",
       "      <td>large</td>\n",
       "      <td>1765.30</td>\n",
       "      <td>709.48</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   transaction_id  product_id  customer_id transaction_date online_order  \\\n",
       "0               1           2         2950       2017-02-25        False   \n",
       "1               2           3         3120       2017-05-21         True   \n",
       "2               3          37          402       2017-10-16        False   \n",
       "3               4          88         3135       2017-08-31        False   \n",
       "4               5          78          787       2017-10-01         True   \n",
       "\n",
       "  order_status           brand product_line product_class product_size  \\\n",
       "0     Approved           Solex     Standard        medium       medium   \n",
       "1     Approved   Trek Bicycles     Standard        medium        large   \n",
       "2     Approved      OHM Cycles     Standard           low       medium   \n",
       "3     Approved  Norco Bicycles     Standard        medium       medium   \n",
       "4     Approved  Giant Bicycles     Standard        medium        large   \n",
       "\n",
       "   list_price  standard_cost  \n",
       "0       71.49          53.62  \n",
       "1     2091.47         388.92  \n",
       "2     1793.43         248.82  \n",
       "3     1198.46         381.10  \n",
       "4     1765.30         709.48  "
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Выведем таблицы, чтобы понять вторая ли нормальная форма у нас\n",
    "customer.head()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "9c5e2ee7",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>transaction_id</th>\n",
       "      <th>product_id</th>\n",
       "      <th>customer_id</th>\n",
       "      <th>transaction_date</th>\n",
       "      <th>online_order</th>\n",
       "      <th>order_status</th>\n",
       "      <th>brand</th>\n",
       "      <th>product_line</th>\n",
       "      <th>product_class</th>\n",
       "      <th>product_size</th>\n",
       "      <th>list_price</th>\n",
       "      <th>standard_cost</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>2</td>\n",
       "      <td>2950</td>\n",
       "      <td>2017-02-25</td>\n",
       "      <td>False</td>\n",
       "      <td>Approved</td>\n",
       "      <td>Solex</td>\n",
       "      <td>Standard</td>\n",
       "      <td>medium</td>\n",
       "      <td>medium</td>\n",
       "      <td>71.49</td>\n",
       "      <td>53.62</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>3</td>\n",
       "      <td>3120</td>\n",
       "      <td>2017-05-21</td>\n",
       "      <td>True</td>\n",
       "      <td>Approved</td>\n",
       "      <td>Trek Bicycles</td>\n",
       "      <td>Standard</td>\n",
       "      <td>medium</td>\n",
       "      <td>large</td>\n",
       "      <td>2091.47</td>\n",
       "      <td>388.92</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>37</td>\n",
       "      <td>402</td>\n",
       "      <td>2017-10-16</td>\n",
       "      <td>False</td>\n",
       "      <td>Approved</td>\n",
       "      <td>OHM Cycles</td>\n",
       "      <td>Standard</td>\n",
       "      <td>low</td>\n",
       "      <td>medium</td>\n",
       "      <td>1793.43</td>\n",
       "      <td>248.82</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>88</td>\n",
       "      <td>3135</td>\n",
       "      <td>2017-08-31</td>\n",
       "      <td>False</td>\n",
       "      <td>Approved</td>\n",
       "      <td>Norco Bicycles</td>\n",
       "      <td>Standard</td>\n",
       "      <td>medium</td>\n",
       "      <td>medium</td>\n",
       "      <td>1198.46</td>\n",
       "      <td>381.10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>78</td>\n",
       "      <td>787</td>\n",
       "      <td>2017-10-01</td>\n",
       "      <td>True</td>\n",
       "      <td>Approved</td>\n",
       "      <td>Giant Bicycles</td>\n",
       "      <td>Standard</td>\n",
       "      <td>medium</td>\n",
       "      <td>large</td>\n",
       "      <td>1765.30</td>\n",
       "      <td>709.48</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   transaction_id  product_id  customer_id transaction_date online_order  \\\n",
       "0               1           2         2950       2017-02-25        False   \n",
       "1               2           3         3120       2017-05-21         True   \n",
       "2               3          37          402       2017-10-16        False   \n",
       "3               4          88         3135       2017-08-31        False   \n",
       "4               5          78          787       2017-10-01         True   \n",
       "\n",
       "  order_status           brand product_line product_class product_size  \\\n",
       "0     Approved           Solex     Standard        medium       medium   \n",
       "1     Approved   Trek Bicycles     Standard        medium        large   \n",
       "2     Approved      OHM Cycles     Standard           low       medium   \n",
       "3     Approved  Norco Bicycles     Standard        medium       medium   \n",
       "4     Approved  Giant Bicycles     Standard        medium        large   \n",
       "\n",
       "   list_price  standard_cost  \n",
       "0       71.49          53.62  \n",
       "1     2091.47         388.92  \n",
       "2     1793.43         248.82  \n",
       "3     1198.46         381.10  \n",
       "4     1765.30         709.48  "
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "transaction.head()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e0a07d96",
   "metadata": {},
   "outputs": [],
   "source": [
    "# С таблицой transaction есть проблема - товары замешаны в транзакциях, что противоречит нормам 2Ф\n",
    "# Разбив таблицу transaction на 2 - транзакции и товары, приведем и к 2Ф и к 3Ф\n",
    "# Можно было бы еще из таблицы customer выделить штаты и посткоды - но мб излишне"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "08587eaa",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Итоговый формат  таблице приложен на диаграмме в гите\n",
    "# Изначально таблица не находилась в 2Ф и 3Ф, так как вероятно товары заводились по ходу покупок и вязались на клиента"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "id": "42f769c1",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>product_id</th>\n",
       "      <th>customer_id</th>\n",
       "      <th>transaction_date</th>\n",
       "      <th>online_order</th>\n",
       "      <th>order_status</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>2</td>\n",
       "      <td>2950</td>\n",
       "      <td>2017-02-25</td>\n",
       "      <td>False</td>\n",
       "      <td>Approved</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>3</td>\n",
       "      <td>3120</td>\n",
       "      <td>2017-05-21</td>\n",
       "      <td>True</td>\n",
       "      <td>Approved</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>37</td>\n",
       "      <td>402</td>\n",
       "      <td>2017-10-16</td>\n",
       "      <td>False</td>\n",
       "      <td>Approved</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>88</td>\n",
       "      <td>3135</td>\n",
       "      <td>2017-08-31</td>\n",
       "      <td>False</td>\n",
       "      <td>Approved</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>78</td>\n",
       "      <td>787</td>\n",
       "      <td>2017-10-01</td>\n",
       "      <td>True</td>\n",
       "      <td>Approved</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   id  product_id  customer_id transaction_date online_order order_status\n",
       "0   1           2         2950       2017-02-25        False     Approved\n",
       "1   2           3         3120       2017-05-21         True     Approved\n",
       "2   3          37          402       2017-10-16        False     Approved\n",
       "3   4          88         3135       2017-08-31        False     Approved\n",
       "4   5          78          787       2017-10-01         True     Approved"
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Пересоздадим таблицу transactions\n",
    "transactions_df = transaction[['transaction_id', 'product_id', 'customer_id', \n",
    "                     'transaction_date', 'online_order', 'order_status']]\n",
    "\n",
    "# Выделим таблицу products\n",
    "products_df = transaction.drop_duplicates(subset='product_id')[['product_id', 'brand', \n",
    "                                                      'product_line', 'product_class', \n",
    "                                                      'product_size', 'list_price', \n",
    "                                                      'standard_cost']]\n",
    "\n",
    "# Переименовываем столбцы для соответствия схеме\n",
    "transactions_df = transactions_df.rename(columns={'transaction_id': 'id'})\n",
    "products_df = products_df.rename(columns={'product_id': 'id'})\n",
    "\n",
    "# Проверяем результаты\n",
    "transactions_df.head()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "ccc5d9c6",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>brand</th>\n",
       "      <th>product_line</th>\n",
       "      <th>product_class</th>\n",
       "      <th>product_size</th>\n",
       "      <th>list_price</th>\n",
       "      <th>standard_cost</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2</td>\n",
       "      <td>Solex</td>\n",
       "      <td>Standard</td>\n",
       "      <td>medium</td>\n",
       "      <td>medium</td>\n",
       "      <td>71.49</td>\n",
       "      <td>53.62</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>3</td>\n",
       "      <td>Trek Bicycles</td>\n",
       "      <td>Standard</td>\n",
       "      <td>medium</td>\n",
       "      <td>large</td>\n",
       "      <td>2091.47</td>\n",
       "      <td>388.92</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>37</td>\n",
       "      <td>OHM Cycles</td>\n",
       "      <td>Standard</td>\n",
       "      <td>low</td>\n",
       "      <td>medium</td>\n",
       "      <td>1793.43</td>\n",
       "      <td>248.82</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>88</td>\n",
       "      <td>Norco Bicycles</td>\n",
       "      <td>Standard</td>\n",
       "      <td>medium</td>\n",
       "      <td>medium</td>\n",
       "      <td>1198.46</td>\n",
       "      <td>381.10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>78</td>\n",
       "      <td>Giant Bicycles</td>\n",
       "      <td>Standard</td>\n",
       "      <td>medium</td>\n",
       "      <td>large</td>\n",
       "      <td>1765.30</td>\n",
       "      <td>709.48</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   id           brand product_line product_class product_size  list_price  \\\n",
       "0   2           Solex     Standard        medium       medium       71.49   \n",
       "1   3   Trek Bicycles     Standard        medium        large     2091.47   \n",
       "2  37      OHM Cycles     Standard           low       medium     1793.43   \n",
       "3  88  Norco Bicycles     Standard        medium       medium     1198.46   \n",
       "4  78  Giant Bicycles     Standard        medium        large     1765.30   \n",
       "\n",
       "   standard_cost  \n",
       "0          53.62  \n",
       "1         388.92  \n",
       "2         248.82  \n",
       "3         381.10  \n",
       "4         709.48  "
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "products_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "id": "89cc334d",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Приведем ключи таблицы customer к нужному формату\n",
    "customer = customer.rename(columns={'customer_id': 'id'})\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "id": "4770abcb",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Спасем да сохраним\n",
    "transactions_df.to_csv('transactions_df.csv')\n",
    "products_df.to_csv('products_df.csv')\n",
    "customer.to_csv('customer.csv')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9e85a881",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.9"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
